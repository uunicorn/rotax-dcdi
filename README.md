The goal of this project is to build a tool to test Ducati DCDI modules on the bench and understand how they work.
The work is split into several steps:
 - trying to infer something from the manual
 - in-place measurements on the running engine
 - experiments with the module on the bench

All experiments were done on the old SMD module PN 965358.

Note: all measurements and calculations here are vague and approximate. The whole thing was only done out of curiosity and to understand how things work.

# Understanding what to expect from the charging coils

According to the manual, stator has 10 poles, 8 of which are allocated for alternator and remaining two are independent charging coils supplying power to each DCDI module.

Rotax heavy maintenance manual specifies the resistance of the charging coils as low as 4.5 ohm. It feels too low to be able to deliver a couple of hundred volts rms required to charge CDI capacitor over the whole range of RPM settings. Therefore we should expect some sort of a voltage booster logic to be implemented inside the modules.

# On the running engine

## Unloaded tests

Unloaded measurements were performed on disconnected coils while running the engine on a single magneto.

### Charging coil

Voltage frequency is a crankshaft rotations per second multiplied by 5.
This is due to 10 magnetic poles on the rotor with a full voltage period requiring 2 poles to pass over the charging coil.

L=13.5 mH
R=4.1 Ohm

#### @ 3210.0 RPM

![Uloaded charging coil @ 3210 RPM](assets/charge-coil/unloaded/unloaded.png)

~212v peak-to-peak

Impedance |Z| = 23 Ohm

Peak short circuit current I = 4.6 A (calculated)

#### @ 2345 RPM

![Uloaded charging coil @ 2345 RPM](assets/charge-coil/unloaded/unloaded-2.png)

~150v peak-to-peak. This is about 53v rms for a sine wave and probably sligly less for the observed signal shape. Definitely not enough to charge CDI capacitor directly.

Impedance |Z| = 17 Ohm

Peak short circuit current I = 4.4 A (calculated)

Energy stored in the coil per alternator period W = 0.136 J
Min full periods between sparks = 2.
Max energy transferred to CDI capacitor between sparks W = 0.272 J
Cut-off voltage across capacitor ~220v.
Max CDI capacitance = 11 uF

### Trigger coil @ 2106 RPM

![Trigger coil @ 2106 RPM](assets/trigger-coil/unloaded.png)

A trigger coil generates two pulses of an opposite polarity per one crankshaft rotation. First pulse is generated by the leading edge of the cam on the flywheel hub (26째 before T.D.C), and the second one by the trailing edge (4째 before T.D.C).

Behavior of the module seems to depend on the peak voltage of the pulses.
Let U1 = absolute peak voltage of the first pulse, U2 = absolute peak voltage of the second pulse.

- U1 < 8v and U2 < 2.5v peak: no spark
- U1 < 8v and U2 >= 2.5v: start mode, the spark is fired at the trailing edge of the cam, 4째 before T.D.C.
- U1 >= 8v and U2 does not matter: normal mode: spark is fired at the leading edge of the cam, 26째 before T.D.C.

Coil voltage depends on a coil gap, so RPM setting on which transition from start mode to normal mode occurs may vary. According to the manual, newer modules do not depend on the peak voltage, instead they switch to a normal mode after a fixed time delay.

Above thresholds are approximate and were measured with a coil loaded by the module. Open circuit voltages under the same conditions should be higher than listed above. Therefore if you measure the first peak to be at or less than 8v above 1000 RPM, then you probably should check your trigger coil gaps.

## Loaded tests

### Charging coil

#### Incomplete charge cycle

In order to boost the charging voltage, the module shortens about the first half of the positive half-period of the wave to the ground. When the current reaches it's maximum, module releases all stored in the coil energy into the capacitor. It works like a boost converter with the stator coil acting as an inductor.

![Incomplete charge cycle](assets/charge-coil/loaded/loaded-incomplete-charge.png)

#### Finished charge cycle

Charging voltage is limited by a threshold (~200v). When it is reached, the coil is again shortened to the ground to prevent capacitor overcharge.

![Finished charge cycle](assets/charge-coil/loaded/loaded-complete-charge.png)

#### Zoom out view of a couple of cycles

On this image it is quite easy to see incomplete charge cycles (threshold not reached) and it is even possible to guess when capacitor was discharged and the spark generated.

![zoom out](assets/charge-coil/loaded/loaded-zoom-out.png)


#### Kill switch on

It looks like the kill switch disables detection of the peak current, so that the coil remains grounded for the whole positive half-period.  

![Kill switch on](assets/charge-coil/loaded/loaded-kill-switch-on.png)


# On the bench

## DC test

12v DC through 24v light bulb and a secondary winding of a 220v to 24v transformer.

![dc test](assets/charge-coil/experiments/attempt-12v-test-coil.png)

## Bench generator test

### Charger driver schematics

Simple half-bridge driver which attempts to simulate the charing coil behaviour.

![charger driver schematics](assets/charge-coil/experiments/driver-schematics.png)

### Trigger driver schematics

![trigger driver schematics](assets/trigger-coil/driver-schematics.png)

### Test run

![bench test](assets/charge-coil/experiments/stand-supply.png)

